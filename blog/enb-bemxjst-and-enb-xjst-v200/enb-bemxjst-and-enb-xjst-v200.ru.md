# Релиз: enb-xjst v2.0.0 и enb-bemxjst v2.0.0

Привет, 

сегодня сразу две хорошие новости — мы выпустили два важных пакета!

Во-первых, пакет `enb-xjst` для сборки **BEMHTML** в *сокращенном* (старом) синтаксисе, где в качестве компилятора используется [XJST](https://en.bem.info/tools/templating-engines/xjst/).

Во-вторых, пакет `enb-bemxjst` для сборки **BEMHTML** в *JS-синтаксисе*, который компилируется с помощью [BEM-XJST](https://ru.bem.info/tools/templating-engines/bemxjst/).

Чтобы не запутаться в выборе пакета, надо понять, какая библиотека лежит в основе проекта:

* `enb-xjst` подойдёт тем, кто использует `bem-bl`.
* `enb-bemxjst` предназначен для пользователей `bem-core`.

Теперь, когда мы определились с пакетом, пора узнать обо всех нововведениях.

## Подключение сторонних библиотек

В отличии от BH в BEMHTML не было никакой нативной возможности использовать сторонние библиотеки в коде шаблонов.

Теперь это можно сделать с помощью опции `requires` в конфиге `enb/make.js`.

**Пример**

Подключаем библиотеку `moment` с помощью модульной системы `CommonJS`:
 
```js
{
    requires: {
        moment: {
            commonJS: 'moment'
        }
    }
}
```

Применяем подключённую библиотеку в шаблоне блока:

```js
block('post').elem('data').content()(function () {
    var moment = this.require('moment');  // Библиотека `moment`

    // Время в миллисекундах, полученное с сервера
    return moment(ctx.param.date).format('YYYY-MM-DD HH:mm:ss');
});
```

Подробности читайте в документации пакетов [enb-xjst](https://ru.bem.info/tools/bem/enb-xjst/readme/#Подключение-сторонних-библиотек) и [enb-bemxjst](https://ru.bem.info/tools/bem/enb-bemxjst/readme/#Особенности-работы-пакета).

## Скорость сборки

В новых версиях пакетов используется [общая очередь дочерних процессов](https://github.com/enb-make/enb#nodegetsharedresources). 

По нашим подсчётам, это изменение значительно ускоряет сборку (на 15-30% быстрее).

Кроме того оптимизирован процесс сборки клиентских шаблонов. В ряде случаев это также уменьшает общее время сборки.

## BEMTREE

Технология BEMTREE имеет одну особенность: она требует наличие библиотеки для работы с промисами [vow](http://dfilatov.github.io/vow/) в глобальной переменной `Vow`.

Раньше перед использованием было необходимо предоставить `vow` в глобальную область видимости. Например, вызывать код шаблонов в новом контексте (`vm.runInNewContext()`) или доклеить код библиотеки `vow` в скомпилированный BEMTREE-файл.

Теперь после сборки скомпилированный BEMTREE-файл по умолчанию содержит в себе весь необходимый код. При необходимости это поведение отключается с помощью опции `includeVow`.

Подробности читайте в описании API технологий для пакетов [enb-xjst](https://ru.bem.info/tools/bem/enb-xjst/api/#includevow) и [enb-bemxjst](https://ru.bem.info/tools/bem/enb-bemxjst/api/#includevow).

## Базовые шаблоны

Когда нас спрашивают о проблемах со сборкой шаблонов, мы первым делом предлагаем проверить, не пропущена ли зависимость от базовых шаблонов. Например, от блока `i-bem.bemhtml` или `i-bem.bemtree`.

Если базовые шаблоны не попали в сборку, то остальные не смогут работать корректно и, вероятно, завершатся с непонятной ошибкой.

```
Error: Match failed.
```

Теперь такой случай будет корректно обработан, и вы увидите понятное сообщение.

```
Error: Seems like you have no base templates from i-bem.bemhtml
```

## История изменений

Подробнее обо всех остальных изменениях читайте в истории изменений пакетов [enb-xjst](https://ru.bem.info/tools/bem/enb-xjst/changelog/#200) и [enb-bemxjst](https://ru.bem.info/tools/bem/enb-bemxjst/changelog/#200).

Вопросы про сборщик ENB традиционно ждем на нашем форуме с [меткой enb](https://ru.bem.info/forum/?labels=enb).

Приятного использования и **Stay BEMed**!
